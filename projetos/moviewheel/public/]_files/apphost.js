define(["exports","./browser.js","./common/appsettings.js","./emby-apiclient/events.js"],function(_exports,_browser,_appsettings,_events){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var appMode=globalThis.appMode,isNativeTizen="tizen"===appMode,isNativeLG="webos"===appMode;function getDeviceId(){if("undefined"!=typeof Windows&&Windows.System){try{var sysIdInfo=Windows.System.Profile.SystemIdentification.getSystemIdForPublisher();if(0<sysIdInfo.id.length)return sysIdString=(sysIdString=(sysIdString=(sysIdString=Windows.Security.Cryptography.CryptographicBuffer.encodeToBase64String(sysIdInfo.id)).replaceAll("+","")).replaceAll("/","")).replaceAll("=",""),Promise.resolve(sysIdString)}catch(ex){}sysIdInfo=new Windows.Security.ExchangeActiveSyncProvisioning.EasClientDeviceInformation;return Promise.resolve(sysIdInfo.id)}var sysIdString="_deviceId2",sysIdInfo=_appsettings.default.get(sysIdString);return sysIdInfo||(sysIdInfo=globalThis.crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)}),_appsettings.default.set(sysIdString,sysIdInfo)),Promise.resolve(sysIdInfo)}function containsGreaseChar(value){return value.includes("\\")||value.includes("/")||value.includes(";")||value.includes('"')||value.toLowerCase().includes("brand")}function isGenericBrand(value){return!!(value=value.toLowerCase()).includes("chromium")}function compareBrands(a,b){a=a.brand||"",b=b.brand||"";return containsGreaseChar(a)&&!containsGreaseChar(b)?1:!containsGreaseChar(a)&&containsGreaseChar(b)?-1:isGenericBrand(a)&&!isGenericBrand(b)?1:!isGenericBrand(a)&&isGenericBrand(b)||a<b?-1:b<a?1:0}function map(i){return i}function getDeviceName(){var modelName,_deviceName,deviceName;return _browser.default.tizen?(_deviceName="Samsung Smart TV",_deviceName+=globalThis.webapis&&globalThis.webapis.productinfo?" ("+globalThis.webapis.productinfo.getRealModel()+")":"",Promise.resolve(_deviceName)):isNativeLG?(_deviceName="LG Smart TV",_deviceName+=0<(modelName=_browser.default.modelName).length?" ("+modelName+")":"",Promise.resolve(_deviceName)):"undefined"!=typeof Windows?Promise.resolve(function(){try{var currentDeviceInfo=new Windows.Security.ExchangeActiveSyncProvisioning.EasClientDeviceInformation;if(currentDeviceInfo.friendlyName&&currentDeviceInfo.friendlyName.length)return currentDeviceInfo.friendlyName}catch(err){}return"Windows.Xbox"!==Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily?"Windows":"Xbox One"}()):_browser.default.operaTv?Promise.resolve("Opera TV"):(_deviceName=Array.prototype.map.call((null==(modelName=navigator.userAgentData)?void 0:modelName.brands)||[],map).sort(compareBrands),deviceName=(deviceName=_deviceName.length?_deviceName[0].brand:deviceName)||"Web Browser",navigator.userAgentData.getHighEntropyValues(["platform"]).then(function(values){return values.platform&&(deviceName+=" "+values.platform),Promise.resolve(deviceName)}))}features={},navigator.share&&(features.sharing=!0),_browser.default.tv||(features.filedownload=!0),(_browser.default.operaTv||isNativeTizen||isNativeLG)&&(features.exit=!0),isNativeLG||(features.exitmenu=!0),isNativeLG||isNativeTizen||(features.plugins=!0,features.screensaver=!0),_browser.default.operaTv||isNativeTizen||isNativeLG||_browser.default.playstation||(features.externallinks=!0,features.externalpremium=!0),_browser.default.operaTv||(features.externallinkdisplay=!0,features.externalappinfo=!0),_browser.default.tv||(features.displaymode=!0,features.fullscreenmediaqueries=!0),function(){var element;if(!_browser.default.tv&&"undefined"!=typeof document)return(element=document.documentElement).requestFullscreen||element.mozRequestFullScreen||element.webkitRequestFullscreen||element.msRequestFullscreen||!!document.createElement("video").webkitEnterFullscreen}()&&(features.fullscreenchange=!0),_browser.default.tizen||_browser.default.operaTv||isNativeLG||_browser.default.netcast||(navigator.hardwareConcurrency||4)<4||(navigator.deviceMemory||2)<2||!globalThis.AudioContext||!document.createElement("audio").canPlayType("audio/mp3").replace(/no/,"")||(features.soundeffects=!0),("embyclient"===appMode||_browser.default.operaTv||isNativeTizen||isNativeLG||globalThis.location.href.toLowerCase().startsWith("https"))&&(features.connectsignup=!0),features.themesongvolume=!0,appMode&&(features.multiserver=!0,!_browser.default.electron)&&"https:"===(globalThis.location||{}).protocol&&(features.rejectinsecureaddresses=!0),_browser.default.tv&&(features.physicalvolumecontrol=!0,features.nativevolumeosd=!0),features.otherapppromotions=!0,features.targetblank=!0,features.subtitleappearancesettings=!0,_browser.default.tv||(features.fileinput=!0,features.keyboardsettings=!0,features.remotecontrol=!0),"undefined"!=typeof Windows&&Windows.System&&"Windows.Xbox"===Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily||(features.youtube=!0),_browser.default.chrome&&(features.chromecast=!0),function(){if(globalThis.matchMedia)try{var isDarkMode=window.matchMedia("(prefers-color-scheme: dark)").matches,isLightMode=window.matchMedia("(prefers-color-scheme: light)").matches,isNotSpecified=window.matchMedia("(prefers-color-scheme: no-preference)").matches;return!(!isDarkMode&&!isLightMode&&!isNotSpecified)}catch(err){}}()&&(features.preferredtheme=!0),isNativeTizen||isNativeLG||(features.premiereinheader=!0),_browser.default.tv&&(features.physicalbackbutton=!0),isNativeTizen||isNativeLG||(features.serversetup=!0),features.subtitlepositionbottom=!0,features.subtitlepositiontop=!0,globalThis.SpeechRecognition&&globalThis.isSecureContext&&(isNativeTizen||isNativeLG||(features.speechrecognition=!0)),(isNativeTizen||isNativeLG)&&(features.forcetranscodingforformats=!0);var features,deviceId,deviceName,supportedFeatures=features;function brandsContain(brands,txt){for(var i=0,length=brands.length;i<length;i++)if((brands[i].brand||"").toLowerCase().includes(txt))return 1}var appVersion,appName=_browser.default.electron?"Emby Theater":isNativeLG?"Emby for LG":isNativeTizen?"Emby for Samsung":"Emby Web",appHost={getWindowState:function(){return document.windowState||"Normal"},setWindowState:function(state){throw new Error("setWindowState is not supported and should not be called")},exit:function(){if(_events.default.trigger(this,"beforeexit"),window.NetCastExit)try{window.NetCastExit()}catch(err){console.log("error closing application: "+err)}else if(window.webOS)try{webOS.platformBack()}catch(err){console.log("error closing application: "+err)}else if(window.tizen)try{tizen.application.getCurrentApplication().exit()}catch(err){console.log("error closing application: "+err)}else window.close()},supports:function(command){return supportedFeatures[command]},moreIcon:"dots-horiz",getSyncProfile:function(){return Emby.importModule("./modules/browserdeviceprofile.js").then(function(profileBuilder){return profileBuilder({maxStaticMusicBitrate:_appsettings.default.maxStaticMusicBitrate()})})},init:function(){return getDeviceId().then(function(generatedDeviceId){return deviceId=generatedDeviceId,getDeviceName().then(function(generatedDeviceName){return deviceName=generatedDeviceName,("undefined"!=typeof Windows&&Windows.ApplicationModel?(generatedDeviceName=Windows.ApplicationModel.Package.current.id.version,Promise.resolve(generatedDeviceName.major+"."+generatedDeviceName.minor+"."+generatedDeviceName.build+"."+generatedDeviceName.revision)):isNativeTizen&&tizen.application&&tizen.application.getAppInfo?Promise.resolve(tizen.application.getAppInfo().version):globalThis.curWidget&&globalThis.curWidget.version?Promise.resolve(globalThis.curWidget.version):globalThis.webOS&&globalThis.webOS.fetchAppInfo?new Promise(function(resolve){globalThis.webOS.fetchAppInfo(function(info){resolve(info.version)})}):Promise.resolve(globalThis.dashboardVersion||"3.0.0")).then(function(generatedAppVersion){appVersion=generatedAppVersion})})})},deviceName:function(){return deviceName},deviceId:function(){return deviceId},appName:function(){return appName},appVersion:function(){return appVersion},getPushTokenInfo:function(){return{}},setTheme:function(themeSettings){var metaThemeColor=document.querySelector("meta[name=theme-color]");metaThemeColor&&metaThemeColor.setAttribute("content",themeSettings.themeColor)},setUserScalable:function(scalable){_browser.default.tv||(scalable=scalable?"viewport-fit=cover, width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes":"viewport-fit=cover, width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no",document.querySelector("meta[name=viewport]").setAttribute("content",scalable))},deviceIconUrl:function(){var _navigator$userAgentD2=(null==(_navigator$userAgentD2=navigator.userAgentData)?void 0:_navigator$userAgentD2.brands)||[];return _browser.default.xboxOne?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/xboxone.png":_browser.default.opera||_browser.default.operaTv?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/opera.png":isNativeTizen?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/samsungtv.png":isNativeLG||_browser.default.netcast?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/lgtv.png":_browser.default.playstation?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/playstation.png":_browser.default.chromecast?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/chromecast.png":brandsContain(_navigator$userAgentD2,"chrome")?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/chrome.png":brandsContain(_navigator$userAgentD2,"safari")?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/safari.png":brandsContain(_navigator$userAgentD2,"firefox")?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/firefox.png":brandsContain(_navigator$userAgentD2,"edge")?"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/edge_chromium.png":"https://github.com/MediaBrowser/Emby.Resources/raw/master/images/devices/html5.png"},getPreferredTheme:function(){try{if(window.matchMedia("(prefers-color-scheme: dark)").matches)return"dark";if(window.matchMedia("(prefers-color-scheme: light)").matches)return"light"}catch(err){}return null},getDefaultLayout:function(){if("undefined"!=typeof Windows&&Windows.System)switch(Windows.System.Profile.AnalyticsInfo.versionInfo.deviceFamily){case"Windows.Desktop":return Windows.UI.ViewManagement.UIViewSettings.getForCurrentView().userInteractionMode===Windows.UI.ViewManagement.UserInteractionMode.touch?"mobile":"desktop";case"Windows.Mobile":return"mobile";case"Windows.Xbox":return"tv";default:return"mobile"}return null},requestSpeechRecognitionPermission:function(){return Promise.resolve()}},appMode=globalThis.document,_isHidden=!1;function onAppVisible(){_isHidden&&(_isHidden=!1,_events.default.trigger(appHost,"resume"))}function onAppHidden(){_isHidden||(_isHidden=!0,_events.default.trigger(appHost,"pause"))}appMode&&appMode.addEventListener("visibilitychange",function(){(document.hidden?onAppHidden:onAppVisible)()}),globalThis.addEventListener&&appMode&&(globalThis.addEventListener("focus",onAppVisible),globalThis.addEventListener("blur",onAppHidden));_exports.default=appHost});